#!/usr/bin/env sh

set -e

changed_files="$(git diff --cached --name-only --diff-filter=ACMR)"

if echo "$changed_files" | grep -q '^client/'; then
  if command -v bun >/dev/null 2>&1; then
    bun run --cwd client lint
    bun run --cwd client test
  else
    pnpm -C client lint
    pnpm -C client test
  fi
fi

if echo "$changed_files" | grep -q '^server/'; then
  (cd server && go test -short ./...)
fi
